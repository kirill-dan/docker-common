# Как работать с docker-common #

Данная сборка создана, как универсальная на разные случаи жизни.

В нее входят контейнеры с Redis, PosgreSQL, PgAdmin, MySQL, Adminer, phpMyAdmin, MailCatcher, Nginx, php-fpm 7.1, NodeJS

В контейнере с php-fpm 7.1 будет создана папка проекта PROJECT_DOMEN (переменная из конфига), 
которая будет связана с директорией project хоста. В папку project и нужно будет помещать свой проект, который будет синхронизироваться 
с проектом в контейнере с php-fpm 7.1.

Переменные окружения и аргументы задаются в файле настроек .env

Как начать работать со сборкой:

Необходимо рядом с папкой docker-common положить папку проекта, которая должна называться project.
```
Структура папок:
 |_docker-common
   |_файлы настроек
 |_project
   |_файлы проекта
 |_node-app
   |_файлы проекта для ноды
```
Ранее в файлах настроек для php и nginx необходимо было прописывать настройки доменов и путей вручную. Сейчас этот процесс автоматизирован.
Данные сами будут подставляться в конфиги из файла настроек. 

Создать локальные доменные имена на своей машине можно в файле add_hosts.sh

Nginx конфиг находится в папке nginx/nginx.conf и nginx/settings.conf. По умолчанию все настроено на максимальную совместимость.  
Но для разных фреймворков настройки будут разными. Поэтому, вам нужно будет вручную менять эти конфиги, согласно вашим требованиям.

Не удаляйте из конфигов такие переменные: {PROJECT_NAME} и {PROJECT_DOMEN}, так как они при сборке докера будут заменятся на значения из 
файла настроек .env

Файл add_hosts.sh необходимо сделать исполняемым, и внутри прописать домены проекта, которые создадут в вашем линуксе, в файле хостов, запись вида: 
```
127.0.0.1   my-project.dev www.my-project.dev
```
Для управления базами данных можно использовать утилиту adminer. Откройте в браузере ваш сайт на 8000 порту. Например: http://localhost:8888

Непосредственно в настройках работы с базой данных, в файле настроек соединения с базой данных, необходимо указывать в качестве хост машины для базы данных имя контейнера с базой. 

Если вы к базе обращаетесь не из другого контейнера, а со своей хост машины, тогда нужно указывать локальный адрес 127.0.0.1

Имя базы, пользователя и пароль: docker (меняется в конфиге)

Пример конфига для Symfony:
```
parameters:
    database_host: postrgesql-$MyProject # docker container name, где $MyProject - это имя проекта в файле настроек .env  
    database_port: 5432
    database_name: docker
    database_user: docker
    database_password: docker
```
Для mySQL все настройки аналогичны.

Для того, чтобы обратится к какому-либо контейнеру, то всегда необходимо указывать имя контейнера (имя контейнеров указано в настройках файла docker-compose.yml и зависит от суффикса в названии проекта в настройках файла .env).

Из предварительных настроек это все. Теперь необходимо назначить права на запуск для файлов add_hosts.sh и install_docker.sh (chmod 755)

Файл install_docker.sh установит в вашу систему все необходимые программы для работы с контейнерами.

А файл add_hosts.sh создаст локальные домены. 

Для того, чтобы зайти в контейнер проекта, необходимо выполнить следующую команду:

```
sudo docker exec -it docker-project bash
```

Где docker-project - это название контейнера

Внимание! Все запущенные контейнеры других проектов нужно отключать, чтобы не происходил конфликт портов.

Очередность запуска скриптов в коммандной строке:

1) install_docker.sh

2) add_hosts.sh

3) docker-compose build

4) docker-compose up

Если необходимо удалить все контейнеры и образы, то это можно сделать, запустив файл remove-images.sh

Если вы что-либо меняете в настрйках докер файлов, то после этого всегда запускайте docker-compose build, и только потом docker-compose up

Все порты можно посмотреть и если нужно изменить в файле docker-compose.yml

Запись такого вида: 
````
ports:
    - 8888:8080
````    
    
указывает на то, то порт 8080, который открыт в контейнере будет проброшен на порт 8888 вашей хост машины. 
То есть на вашем компьютере нужно будет обращаться к пору 8888, например localhost:8888, для того, чтобы обратиться к Adminer     

Для того, чтобы запустить ноду, то в директорию node-app необходимо положить файл необходимого вам конфига: package.json
Для того чтобы проинсталить npm вы можете добавить в package.json, например, такую строчку:

```
"scripts": {
    "start": "npm install && npm start"
},
```

PS. Между npm install и npm start должны стоять два амперсанда.
